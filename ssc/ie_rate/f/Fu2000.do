clear
//FU 2000 Full Data
//Fu, W. J. 2000. “The Ridge Estimator in Singular Design with 
// Application to Age, Period, Cohort Analysis of Disease Rates,” 
//Communication in Statistics – Theory and Methods, 29: 263-278.
input ageLo ageHi perLo perHi y
20	24	60	64	3.89
25	29	60	64	16.01
30	34	60	64	26.02
35	39	60	64	38.84
40	44	60	64	47.65
45	49	60	64	51.48
50	54	60	64	49.12
55	59	60	64	51.48
60	64	60	64	47.68
65	69	60	64	40.44
70	74	60	64	42.4
75	79	60	64	42.44
80	84	60	64	41.5
85	99	60	64	30.79
20	24	65	69	3.24
25	29	65	69	11.18
30	34	65	69	21.14
35	39	65	69	25.09
40	44	65	69	32.5
45	49	65	69	36.69
50	54	65	69	37.26
55	59	65	69	40.87
60	64	65	69	42.8
65	69	65	69	39.17
70	74	65	69	35.32
75	79	65	69	36.68
80	84	65	69	29.74
85	99	65	69	32.43
20	24	70	74	2.9
25	29	70	74	8.92
30	34	70	74	16.23
35	39	70	74	21.07
40	44	70	74	22.71
45	49	70	74	22.15
50	54	70	74	25.51
55	59	70	74	34.7
60	64	70	74	29.76
65	69	70	74	31.44
70	74	70	74	27.78
75	79	70	74	28.75
80	84	70	74	31.54
85	99	70	74	37.1
20	24	75	79	2.05
25	29	75	79	9.74
30	34	75	79	15.84
35	39	75	79	18.74
40	44	75	79	20.01
45	49	75	79	19.2
50	54	75	79	18.41
55	59	75	79	21.83
60	64	75	79	22.71
65	69	75	79	28.79
70	74	75	79	24.31
75	79	75	79	25.22
80	84	75	79	22.31
85	99	75	79	19.81
20	24	80	84	2.19
25	29	80	84	8.48
30	34	80	84	14.54
35	39	80	84	18.8
40	44	80	84	18.78
45	49	80	84	17.74
50	54	80	84	16.66
55	59	80	84	16.97
60	64	80	84	20.16
65	69	80	84	23.35
70	74	80	84	20.27
75	79	80	84	21.17
80	84	80	84	20.04
85	99	80	84	16.42
20	24	85	89	1.76
25	29	85	89	7.43
30	34	85	89	13.67
35	39	85	89	18.04
40	44	85	89	16.19
45	49	85	89	17.29
50	54	85	89	15.41
55	59	85	89	17.69
60	64	85	89	17.69
65	69	85	89	19.26
70	74	85	89	20.19
75	79	85	89	21.08
80	84	85	89	15.25
85	99	85	89	14.87
20	24	90	94	1.73
25	29	90	94	7.54
30	34	90	94	12.71
35	39	90	94	18.18
40	44	90	94	18.12
45	49	90	94	18.31
50	54	90	94	14.07
55	59	90	94	13.73
60	64	90	94	16.94
65	69	90	94	19.16
70	74	90	94	14.95
75	79	90	94	19.43
80	84	90	94	21.28
85	99	90	94	12.06
end
gen age = ageLo
gen period = perLo + 1900
gen logy = log(y)
qui tab age, gen(a)
scal arow = r(r)
qui tab period, gen(p)
scal prow = r(r)
qui gen cohort = period - age
qui tab cohort, gen(c)
scal crow = r(r) 

* construct ANOVA normalization using last category as reference

forval i = 1/`=arow' {
 gen aC`i' = a`i' - a`=arow'
 }

forval i = 1/`=prow' {
 gen pC`i' = p`i' - p`=prow'
 }
 
forval i = 1/`=crow' {
 gen cC`i' = c`i' - c`=crow'
}

ie_reg logy aC1-aC13 pC1-pC6 cC1-cC19
ie_norm, groups(aC1-aC14, pC1-pC7, cC1-cC20) 

